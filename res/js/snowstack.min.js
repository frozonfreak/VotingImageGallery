function cameraTransformForCell(e){var t=Math.floor(e/snowstack_options.rows);var n=e-t*snowstack_options.rows;var r=(t+.5)*CXSPACING;var i=(n+.5)*CYSPACING;if(magnifyMode){return vfx.translate3d(-r,-i,180)}else{return vfx.translate3d(-r,-i,0)}}function layoutElement(e,t,n){var r=Math.min(CHEIGHT/n,CWIDTH/t);t*=r;n*=r;e.style.width=Math.round(t)+"px";e.style.height=Math.round(n)+"px";e.style.left=Math.round((CWIDTH-t)/2)+"px";e.style.top=Math.round((CHEIGHT-n)/2)+"px"}function play_video(e){if(currentVideo&&!currentVideo.isPaused()){currentVideo.setMuted(true)}currentVideo=e;currentVideo.setMuted(false);currentVideo.play()}function html5video(e,t){var n=vfx.elem("video",{"class":"media"});var r=function(t){layoutElement(n,n.videoWidth,n.videoHeight);e.parentNode.appendChild(n);e.parentNode.removeChild(e);return false};var i=function(e){play_video(t.video);return false};n.addEventListener("loadedmetadata",r,false);n.addEventListener("canplay",i,false);n.src=t.info.video;n.load();t.video={play:function(){n.play()},pause:function(){n.pause()},isPaused:function(){return n.paused},setMuted:function(e){n.muted=e},isMuted:function(){return n.muted}}}function refreshImage(e,t){if(zoomTimer){clearTimeout(zoomTimer)}if(t.video){if(t.video.isPaused()||t.video.isMuted()){play_video(t.video)}return}zoomTimer=setTimeout(function(){if(t.info.zoom&&!t.video){e.src=t.info.zoom}zoomTimer=null},2e3)}function setcellclass(e,t){e.div.className=t;if(e.reflection){e.reflection.className=t}}function snowstack_togglemedia(e){var t=cells[e];if(t.video){if(t.video.isPaused()){play_video(t.video)}else{t.video.pause()}return}if(t.info.videoloader){t.info.videoloader(t.divimage,t)}else if(t.info.video){html5video(t.divimage,t)}}function snowstack_update(e,t){if(currentCellIndex==e&&magnifyMode==t){return}if(currentCellIndex!=-1){var n=cells[currentCellIndex];setcellclass(n,"cell")}if(cells.length===0){return}e=Math.min(Math.max(e,0),cells.length-1);currentCellIndex=e;var r=cells[e];magnifyMode=t;if(magnifyMode){if(newbieUser){newbieUser=false}r.div.className="cell magnify";if(snowstack_options.refreshzoom){refreshImage(r.divimage,r)}}else{setcellclass(r,"cell selected")}if(snowstack_options.captions&&!newbieUser){caption.innerText=r.info.title}dolly.style.webkitTransform=cameraTransformForCell(e);var i=new WebKitCSSMatrix(document.defaultView.getComputedStyle(dolly,null).webkitTransform);var s=new WebKitCSSMatrix(dolly.style.webkitTransform);var o=i.m41-s.m41;var u=Math.min(Math.max(o/(CXSPACING*3),-1),1)*45;camera.style.webkitTransform="rotateY("+u+"deg)";camera.style.webkitTransitionDuration="330ms";if(currentTimer){clearTimeout(currentTimer)}currentTimer=setTimeout(function(){camera.style.webkitTransform="rotateY(0)";camera.style.webkitTransitionDuration="5s"},330)}function snowstack_addimage(e){function o(){var e=vfx.elem("div",{"class":"cell",style:"width: "+CWIDTH+"px; height: "+CHEIGHT+"px"});e.style.webkitTransform=vfx.translate3d(r*CXSPACING,i*CYSPACING,0);return e}var t={};var n=cells.length;cells.push(t);var r=Math.floor(n/snowstack_options.rows);var i=n-r*snowstack_options.rows;if(typeof e==="string"){var s=e;e={thumb:s,zoom:s,title:""}}t.info=e;t.div=o();t.divimage=vfx.elem("img",{"class":"media"});vfx.loadhandler(t.divimage,function(){layoutElement(t.divimage,t.divimage.width,t.divimage.height);if(t.info.link){t.div.appendChild(vfx.elem("a",{"class":"mover view",href:t.info.link,target:"_blank"},t.divimage))}else{t.div.appendChild(vfx.elem("div",{"class":"mover view"},t.divimage))}t.div.style.opacity=1});t.div.style.opacity=0;cellstack.appendChild(t.div);t.divimage.src=e.thumb;if(i==snowstack_options.rows-1){t.reflection=o();t.reflectionimage=vfx.elem("img",{"class":"media reflection"});vfx.loadhandler(t.reflectionimage,function(){layoutElement(t.reflectionimage,t.reflectionimage.width,t.reflectionimage.height);t.reflection.appendChild(vfx.elem("div",{"class":"mover view"},t.reflectionimage));t.reflection.style.opacity=1});t.reflection.style.opacity=0;reflectionstack.appendChild(t.reflection);t.reflectionimage.src=e.thumb}}function snowstack_sort(e){var t;if(e=="date"){t=function(e,t){var n=new Date("1 "+e.info.date);var r=new Date("1 "+t.info.date);return r-n}}else{t=function(t,n){var r=t.info[e];var i=n.info[e];return r>i?1:r<i?-1:0}}cells.sort(t);for(var n=0;n<cells.length;++n){var r=Math.floor(n/snowstack_options.rows);var i=n-r*snowstack_options.rows;cells[n].div.style.webkitTransform=vfx.translate3d(r*CXSPACING,i*CYSPACING,0)}}function snowstack_startsearch(){camera.style.webkitTransform="translate3d(0, 0, -500px)";camera.style.webkitTransitionDuration="1s"}function snowstack_endsearch(){camera.style.webkitTransform=""}function snowstack_search(e,t){if(t.length){snowstack_startsearch()}else{snowstack_endsearch()}var n=new RegExp(t,"i");for(var r=0;r<cells.length;++r){var i;if(t.length){i=cells[r].info[e].search(n)!=-1}else{i=true}cells[r].div.style.opacity=i?1:.2}}function snowstack_voteimage(e){var t=cells[e];$.ajax({url:"res/scripts/getImage.php",type:"POST",data:{param:"Vote",user:t.info.user,image:t.info.image},success:function(e){alert(e)}})}var global=this;var CWIDTH;var CHEIGHT;var CGAP=10;var CXSPACING;var CYSPACING;var snowstack_options={rows:3,refreshzoom:true,captions:false};var vfx={elem:function(e,t,n){var r=document.createElement(e);if(t){for(var i in t){if(t.hasOwnProperty(i)){r.setAttribute(i,t[i])}}}if(n){r.appendChild(n)}return r},byid:function(e){return document.getElementById(e)},loadhandler:function(e,t){e.addEventListener("load",t,false)},translate3d:function(e,t,n){return"translate3d("+e+"px, "+t+"px, "+n+"px)"}};var currentCellIndex=-1;var cells=[];var dolly;var camera;var caption;var cellstack;var reflectionstack;var magnifyMode;var newbieUser=true;var zoomTimer=null;var currentTimer=null;var currentVideo=null;global.snowstack_init=function(e,t){function l(){var t=currentCellIndex;if(o.left){if(t>=snowstack_options.rows){t-=snowstack_options.rows}}if(o.right){if(t+snowstack_options.rows<cells.length){t+=snowstack_options.rows}else if(!n){n=true;e(function(e){e.forEach(snowstack_addimage);n=false})}}if(o.up){t-=1}if(o.down){t+=1}snowstack_update(t,magnifyMode)}function c(){l();a=setTimeout(c,f);f=60}function h(){if(o.left||o.right||o.up||o.down){if(a===null){f=330;c()}}else{clearTimeout(a);a=null}}var n=true;camera=vfx.byid("camera");reflectionstack=vfx.elem("div",{"class":"view"});var r=vfx.elem("div",{"class":"view"},reflectionstack);cellstack=vfx.elem("div",{"class":"view"});dolly=vfx.elem("div",{"class":"dolly view"});dolly.appendChild(cellstack);dolly.appendChild(r);while(camera.hasChildNodes()){camera.removeChild(camera.firstChild)}camera.appendChild(dolly);if(t){for(var i in t){if(t.hasOwnProperty(i)){snowstack_options[i]=t[i]}}}if(typeof e!=="function"){var s=e;e=function(e){e(s);s=[]}}CHEIGHT=Math.round(window.innerHeight/(snowstack_options.rows+2));CWIDTH=Math.round(CHEIGHT*300/180);CXSPACING=CWIDTH+CGAP;CYSPACING=CHEIGHT+CGAP;r.style.webkitTransform="scaleY(-1.0) "+vfx.translate3d(0,-CYSPACING*snowstack_options.rows*2-1,0);e(function(e){e.forEach(snowstack_addimage);snowstack_update(Math.floor(snowstack_options.rows/2),false);n=false});var o={left:false,right:false,up:false,down:false};var u={37:"left",38:"up",39:"right",40:"down"};var a=null;var f=330;window.addEventListener("keydown",function(e){if(e.keyCode==32){snowstack_update(currentCellIndex,!magnifyMode)}else if(e.keyCode==13){snowstack_togglemedia(currentCellIndex)}else if(e.keyCode==86){snowstack_voteimage(currentCellIndex)}else{o[u[e.keyCode]]=true}h()});window.addEventListener("keyup",function(e){o[u[e.keyCode]]=false;h()});var p=0;var d=0;var v=document.getElementById("camera");v.addEventListener("touchstart",function(e){p=event.touches[0].pageX;d=p;e.preventDefault();return false},false);v.addEventListener("touchmove",function(e){d=event.touches[0].pageX;var t=d-p;o.left=t>20;o.right=t<20;l();p=d;e.preventDefault();return false},true);v.addEventListener("touchend",function(e){o.left=false;o.right=false;e.preventDefault();return false},true)}